      subroutine test_zself_adap(isuc)

      implicit real *8 (a-h,o-z)
      real *8, allocatable :: ts(:),wts(:),umat(:,:),vmat(:,:)
      real *8, allocatable :: srcvals(:,:),srccoefs(:,:)
      real *8 xytarg(2,100)
      complex *16, allocatable :: zintvals(:,:),zintvalsex(:,:)
      integer ipars
      real *8 dpars
      complex *16 zpars,ima
      data ima/(0.0d0,1.0d0)/

      external zlslp

      done = 1
      pi = atan(done)*4

      call prini(6,13)
      nsuccess = 0

      norder = 8
      allocate(srccoefs(6,norder),srcvals(8,norder))
      allocate(ts(norder),wts(norder),umat(norder,norder),
     1   vmat(norder,norder))  
c
c   get legendre nodes, weights and vals2coefs and coefs2vals 
c   matrices
c
      itype = 2
      call legeexps(itype,norder,ts,umat,vmat,wts)

      xshift = 1.1d0
      yshift = 0.3d0
      tt0 = 0.6d0

      do i=1,norder
        srcvals(1,i) = ts(i) + xshift
        srcvals(2,i) = yshift
        srcvals(3,i) = 1
        srcvals(4,i) = 0
        srcvals(5,i) = 0
        srcvals(6,i) = 0
        srcvals(7,i) = 0
        srcvals(8,i) = 1

        do j=1,6
          srccoefs(j,i) = 0
        enddo
      enddo

      do i=1,norder
        do j=1,6
          do l=1,norder
            srccoefs(j,i) = srccoefs(j,i) + umat(i,l)*srcvals(j,l)
          enddo
        enddo
      enddo

      ntarg = 1
      xytarg(1,1) = tt0 + xshift
      xytarg(2,1) = yshift
      
      eps = 1.0d-10
      ndtarg = 2
      ndd = 0
      ndz = 0
      ndi = 0
      nporder = 15
      nchmax = 100000
      allocate(zintvals(nporder,ntarg),zintvalsex(nporder,ntarg))

      ipv = 0

      call zget_adap_lege_self(ipv,eps,norder,tt0,srccoefs,ndtarg,
     1  xytarg,nporder,zlslp,ndd,dpars,ndz,zpars,ndi,ipars,nchmax,
     2  zintvals)

      zintvalsex(1,1) = -0.25695732451367267d0
      zintvalsex(2,1) = -0.16609635790398571d0
      zintvalsex(3,1) = 0.006445480652205463d0

      call prin2('zintvalsex=*',zintvalsex(1:3,1),6)
      call prin2('zintvals=*',zintvals(1:3,1),6)
      
      erra = 0
      ra = 0
      do i=1,ntarg
        do j=1,3
          ra = ra + zintvalsex(j,i)**2
          erra = erra + (zintvals(j,i)-zintvalsex(j,i))**2
        enddo
      enddo
      erra = sqrt(erra/ra)
      call prin2('error in computing integrals=*',erra,1)

      isuc = 0
      if(abs(erra).lt.eps) isuc = 1

      return
      end




      subroutine zlslp(x,ndtarg,y,ndd,dpars,ndz,zpars,ndi,ipars,f)
      implicit real *8 (a-h,o-z)
      real *8 x(6), y(ndtarg),dpars(ndd)
      complex *16 zpars(ndz)
      integer ipars(ndi)
      complex *16 f,z

      done = 1
      pi = atan(done)*4

      z = dcmplx(y(1)-x(1),y(2)-x(2))
      f = 1.0d0/2/pi*log(abs(z))

      return
      end


        subroutine load_quad0(xs,ws,ns)
        implicit real *8 (a-h,o-z)
        dimension xr(120), wr(120),xs(*), ws(*)
c
c
c
        ns = 120
c
c
c
        data xr/
     *   -.99999975520451552471733667111368D+00,
     *   -.99999752551488137517641548310244D+00,
     *   -.99999082984012979197526008719450D+00,
     *   -.99996513782171034178403392529340D+00,
     *   -.99991669972427559393539663143233D+00,
     *   -.99983894309969152264462269258850D+00,
     *   -.99973455668573100060801347629638D+00,
     *   -.99963151283247848113341947420811D+00,
     *   -.99936034023527587282171732060573D+00,
     *   -.99915728833213632957278035218634D+00,
     *   -.99868224024112576028056356260452D+00,
     *   -.99825775235573420135147572976784D+00,
     *   -.99744557482690916605912089769853D+00,
     *   -.99668622824036718302401673951394D+00,
     *   -.99553897042664874012508016402274D+00,
     *   -.99451993244344702747966836861957D+00,
     *   -.99304186078350638814689241651768D+00,
     *   -.99079813934101771585286453795672D+00,
     *   -.98904804477504815173900740900128D+00,
     *   -.98641518374826186083262849379443D+00,
     *   -.98215427253773355992850498506899D+00,
     *   -.97887358634549140907341958273086D+00,
     *   -.97501612301764478096997215179672D+00,
     *   -.97097511111153312177947991481102D+00,
     *   -.96430313259041740308111099800540D+00,
     *   -.95771233850532793409068315752315D+00,
     *   -.95157009884396510148776540410110D+00,
     *   -.94308245548000975234804458990266D+00,
     *   -.93250143768603832536354333937745D+00,
     *   -.92384538683326203725251690485961D+00,
     *   -.91244220254521472650353440269522D+00,
     *   -.90005025556418544583747632850599D+00,
     *   -.88616849928098670096448635706117D+00,
     *   -.86612943728209444961668369272344D+00,
     *   -.84994888170069450417426017047901D+00,
     *   -.83453240750998414260448078567432D+00,
     *   -.81932248915266520970683036923437D+00,
     *   -.79046415865620311774112152436900D+00,
     *   -.77205378982375757791293307772973D+00,
     *   -.74000530469119948479886257733863D+00,
     *   -.71735359811754529923839734759583D+00,
     *   -.69371073506220928064773172175089D+00,
     *   -.66903242004417809249875844622206D+00,
     *   -.64275842929443334701150013822115D+00,
     *   -.60264982683007546781972645695651D+00,
     *   -.57485875010874795495756273398242D+00,
     *   -.54405012648335080071370583244118D+00,
     *   -.51362097869715476926501489182745D+00,
     *   -.46736473873336271189387880172455D+00,
     *   -.43750729354935411218881670139450D+00,
     *   -.40229292049380977814989730255032D+00,
     *   -.35265129491788629964080975816792D+00,
     *   -.31867538845749992561440376232246D+00,
     *   -.28261724398266767805222732326417D+00,
     *   -.23224076587365008124758775353990D+00,
     *   -.19373231136391865035213434716964D+00,
     *   -.15760463856042137544845686509862D+00,
     *   -.10266598994609540784784608458790D+00,
     *   -.62523356132671976402965790438865D-01,
     *   -.22334749277538118657188057526688D-01,
     *   0.27294057340962732114936705275539D-01,
     *   0.62506186500878862472991101190894D-01,
     *   0.10266515159847253498751817861226D+00,
     *   0.15760579751591746499381297850151D+00,
     *   0.19370724894385604680172131470930D+00,
     *   0.23223129257350651398557754993819D+00,
     *   0.28261674875685690559018201650224D+00,
     *   0.31875135316055762444477626586020D+00,
     *   0.35266376409047459896919894493820D+00,
     *   0.40228966814583085041408026093820D+00,
     *   0.43751950628633603455225240650623D+00,
     *   0.46738649774373431578950158312523D+00,
     *   0.51366575985691320965033528860169D+00,
     *   0.54408567851612694215381928363510D+00,
     *   0.57487740453411853073529998281323D+00,
     *   0.60268334054709322586112649864465D+00,
     *   0.64278383194975427662252016553478D+00,
     *   0.66912057329709866272789961415277D+00,
     *   0.69373737457565247852121202723699D+00,
     *   0.71735868029300413168078825571684D+00,
     *   0.73998920836952200444063414262285D+00,
     *   0.77202140679934847373190332074249D+00,
     *   0.79045644742415004556713215207726D+00,
     *   0.81931611533680736251208780057855D+00,
     *   0.83455839823412342004848088511949D+00,
     *   0.84994582479823423400445005139187D+00,
     *   0.86615417380655377423078467849518D+00,
     *   0.88617230163107361326934816204650D+00,
     *   0.90003328886604420764153886113276D+00,
     *   0.91244374526580573410086054317233D+00,
     *   0.92383261440445789971574401783873D+00,
     *   0.93249414888928368889177786297284D+00,
     *   0.94308068837266565924492572609589D+00,
     *   0.95157446626475341913034291827235D+00,
     *   0.95773778684054723496505324526407D+00,
     *   0.96431922833431935009462542295063D+00,
     *   0.97097750691539125828758662603020D+00,
     *   0.97503504422141239953585027786184D+00,
     *   0.97887510536008268999687879626101D+00,
     *   0.98215385408293554107424259464349D+00,
     *   0.98642017724026545559032405390015D+00,
     *   0.98905951186718633229850921656865D+00,
     *   0.99078555431521598765608424496270D+00,
     *   0.99303844593086824213328904888619D+00,
     *   0.99452563566424619230115066551000D+00,
     *   0.99553915580547169268726448969992D+00,
     *   0.99669062770091704252757992074757D+00,
     *   0.99745217869547606538892649031539D+00,
     *   0.99826370143232817879107251047737D+00,
     *   0.99867965741799275521947350623848D+00,
     *   0.99914868962534199884883440187102D+00,
     *   0.99936464390172196157242511391904D+00,
     *   0.99963551897038737260565263302785D+00,
     *   0.99972174142001472522225974151196D+00,
     *   0.99984370899006366858909499826032D+00,
     *   0.99993042572224805288475470008885D+00,
     *   0.99997297465596289469802539440781D+00,
     *   0.99999376928249271486905166106967D+00,
     *   0.99999873449748464290015839468730D+00,
     *   0.99999984759542405465572734657589D+00/
c
c
c
        data wr/
     *   0.90256162205470645390154303345819D-06,
     *   0.33955748547428717362594256391177D-05,
     *   0.13084951296353090815327938833251D-04,
     *   0.39772277388724015177757250535242D-04,
     *   0.53978050735882729586926017318378D-04,
     *   0.11563859012565678616687040539803D-03,
     *   0.41648837193484338858333728823017D-04,
     *   0.23283380906247373196282341374930D-03,
     *   0.22077930361493833896399595168985D-03,
     *   0.32755363579602605188924584370342D-03,
     *   0.49172169529418717084751163496487D-03,
     *   0.52179460234335375722955177648176D-03,
     *   0.97214957588934974384974463083569D-03,
     *   0.66789237465505486302069712114248D-03,
     *   0.15487180911314304635760436700682D-02,
     *   0.61116021602145872966128827298154D-03,
     *   0.22911288805556671969810818363519D-02,
     *   0.19040187426788376645141641939886D-02,
     *   0.19767220401340524878179496458782D-02,
     *   0.34179542204184335496199756804406D-02,
     *   0.47733871390309279693834284031647D-02,
     *   0.20147708305800478931117781409939D-02,
     *   0.52600173521062887509461879195432D-02,
     *   0.40043859263324671039313274674481D-02,
     *   0.85017727969507924651440015194511D-02,
     *   0.40792020157634084616978469073743D-02,
     *   0.89495416032316421893576715214431D-02,
     *   0.82449712144654019755844429333215D-02,
     *   0.12376888441702101554632580750547D-01,
     *   0.60254314695094010599574021766880D-02,
     *   0.15892686030608890872059275913338D-01,
     *   0.88049608727102280461542783828860D-02,
     *   0.20007815895956752177798615206106D-01,
     *   0.17170804690286857499365440669824D-01,
     *   0.18836716234223717879249475560240D-01,
     *   0.75532337043405040040072611146481D-02,
     *   0.27608906885872394495208483810750D-01,
     *   0.24105936205480040938316882049415D-01,
     *   0.21738200232003393204500627832493D-01,
     *   0.36935249528437155958477133459628D-01,
     *   0.88258929229496283725547430411950D-02,
     *   0.38333870333059529120316931496179D-01,
     *   0.11330109440462378241138886749532D-01,
     *   0.42043067300520373984449676443281D-01,
     *   0.33026455335748583121524820178560D-01,
     *   0.29394982930746992243064504512388D-01,
     *   0.26930265807116134745607738630871D-01,
     *   0.40189952820706697742495179884742D-01,
     *   0.46135710994903749289752651613643D-01,
     *   0.18911027585133877189896335902731D-01,
     *   0.49911710058341261678864289136294D-01,
     *   0.44929821187337237208477044396020D-01,
     *   0.27098854696676260964325452118009D-01,
     *   0.46318861587922265345579841870682D-01,
     *   0.50851067846609868452175844491793D-01,
     *   0.25445937476572720732808278457668D-01,
     *   0.51989057522869027339023952112693D-01,
     *   0.51662753278097778472009405344953D-01,
     *   0.32263103437961819853013888662507D-01,
     *   0.48974949385914777781540167204015D-01,
     *   0.46196780412672423930517165303054D-01,
     *   0.28469326817227844993822402495916D-01,
     *   0.52641694926068080854197710598494D-01,
     *   0.51555550404413705524288523645304D-01,
     *   0.25775322246394118127949289106075D-01,
     *   0.50664951606441057535769590790965D-01,
     *   0.46492763140405167507884952897324D-01,
     *   0.26995686127155521681311923921701D-01,
     *   0.44953883786537636932500443324269D-01,
     *   0.49857147294520453596963539526645D-01,
     *   0.18997178722875453588215745493778D-01,
     *   0.46094130144551406224380969210604D-01,
     *   0.40262659216883472646853141605243D-01,
     *   0.26833201708979150645219857965175D-01,
     *   0.29463630964203862729350965751229D-01,
     *   0.32985059193711098628731066199857D-01,
     *   0.42082549773488413538774473839757D-01,
     *   0.11306479519337684829390290090119D-01,
     *   0.38342238898160331559309818904301D-01,
     *   0.87589135890523624701635002557944D-02,
     *   0.36946777258489394042304839281292D-01,
     *   0.21720810840023195960485373750708D-01,
     *   0.24138996259921229366679900998415D-01,
     *   0.27602900146673875144949723350058D-01,
     *   0.75692449325786146683368865219375D-02,
     *   0.18835140265173024942555853692719D-01,
     *   0.17184704357381405542098745157753D-01,
     *   0.19968452496933155429310347527917D-01,
     *   0.88274376064824293856301678551615D-02,
     *   0.15879766609818022556459983299271D-01,
     *   0.60296827877567346767974787696237D-02,
     *   0.12369130789144441174088504690977D-01,
     *   0.82671844505332964196221308947291D-02,
     *   0.89370722725448313282106627012506D-02,
     *   0.41141029163783643835695088659150D-02,
     *   0.84714102625766187759205193706914D-02,
     *   0.40201678865950900343119898570644D-02,
     *   0.52556875788868933074544792837882D-02,
     *   0.19976256731345741924574523717955D-02,
     *   0.47770351162915306689304593363065D-02,
     *   0.34303899534118250538943446626098D-02,
     *   0.19589397358108874825533170000616D-02,
     *   0.19005973560804389974502836398003D-02,
     *   0.22995570592156932742092944972415D-02,
     *   0.61416395503251459999941543948359D-03,
     *   0.15449159342025771985886632411583D-02,
     *   0.67759240331880465348221712037483D-03,
     *   0.96850445772120080010806326844702D-03,
     *   0.51947008397910824936375111208800D-03,
     *   0.48290493638766198780295795537236D-03,
     *   0.32687085927329987419784601845049D-03,
     *   0.23306686371312868261063310106971D-03,
     *   0.22512050919508631497288913047300D-03,
     *   0.43386618702941525353074844991894D-04,
     *   0.12586102737059611269815881544539D-03,
     *   0.56332130780650652426574155304694D-04,
     *   0.31665728507261550027057654113002D-04,
     *   0.10763683873128996150171766009159D-04,
     *   0.16819388415283334653184810824124D-05,
     *   0.55671413015744864330802997718541D-06/
c
c
c
        do i=1,120
          xs(i) = xr(i)
          ws(i) = wr(i)
        enddo
c
c
c
        return
        end
     

